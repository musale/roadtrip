<!doctype html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <link rel="icon" type="image/svg+xml" href="/vite.svg" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>RoadTrip</title>
  <link href='https://unpkg.com/maplibre-gl@^4/dist/maplibre-gl.css' rel='stylesheet' />

</head>

<body class="bg-black text-white font-body overflow-hidden h-screen w-screen flex items-center justify-center">
  <div id="app" class="relative h-full w-full">
    <!-- Video Feed -->
    <div id="videoContainer" class="absolute inset-0 w-full h-full">
      <video id="cameraFeed" class="absolute inset-0 w-full h-full object-cover bg-black" autoplay playsinline
        muted></video>
      <div id="dualVideoContainer" class="dual-video-container invisible absolute inset-0 flex gap-3 p-3 bg-black/30">
        <div
          class="dual-video-panel relative flex-1 rounded-xl overflow-hidden border border-white/20 bg-black/60 backdrop-blur-sm">
          <video id="dualBackVideo" class="w-full h-full object-cover" autoplay playsinline muted></video>
          <span
            class="camera-label absolute top-2 right-2 px-3 py-1 text-xs font-heading uppercase tracking-wide rounded-full bg-black/70 text-white">Back
            Camera</span>
        </div>
        <div
          class="dual-video-panel relative flex-1 rounded-xl overflow-hidden border border-white/20 bg-black/60 backdrop-blur-sm">
          <video id="dualFrontVideo" class="w-full h-full object-cover" autoplay playsinline muted></video>
          <span
            class="camera-label absolute top-2 right-2 px-3 py-1 text-xs font-heading uppercase tracking-wide rounded-full bg-black/70 text-white">Front
            Camera</span>
        </div>
      </div>
      <div id="cameraStatusMessage"
        class="pointer-events-none absolute top-4 left-1/2 -translate-x-1/2 w-full max-w-lg px-4 transition-opacity duration-300 ease-out opacity-0">
        <div
          class="w-full text-center space-y-3 bg-black/80 border border-white/10 backdrop-blur-md rounded-xl px-6 py-5 shadow-neon">
          <h2 class="text-lg font-heading text-brand" id="cameraStatusTitle">Camera Status</h2>
          <p class="text-sm text-white/80" id="cameraStatusBody">Checking for cameras…</p>
        </div>
      </div>
    </div>

    <!-- Overlay Container for all UI elements -->
    <div class="absolute inset-0 p-4 md:p-8">

      <!-- Landscape Nudge Banner (hidden by default) -->
      <div id="landscapeNudge"
        class="hidden absolute top-4 left-1/2 -translate-x-1/2 w-11/12 max-w-sm z-50 bg-yellow-400 text-black text-sm text-center p-2 rounded-lg shadow-lg flex items-center justify-between gap-2">
        <span>Best in landscape — rotate your phone.</span>
        <button id="dismissNudge" class="text-black/70 hover:text-black font-bold text-lg leading-none">&times;</button>
      </div>

      <!-- Top-Left: Live HUD (initially hidden) -->
      <div id="liveHud"
        class="hidden absolute top-4 left-4 md:top-8 md:left-8 bg-black bg-opacity-50 p-3 rounded-lg shadow-lg max-w-xs text-brand font-heading text-sm md:text-base">
        <div class="flex justify-between">
          <span>SPEED:</span>
          <span id="hudSpeed">0.0 MPH</span>
        </div>
        <div class="flex justify-between">
          <span>DIST:</span>
          <span id="hudDistance">0.0 MI</span>
        </div>
        <div class="flex justify-between">
          <span>TIME:</span>
          <span id="hudTime">00:00:00</span>
        </div>
      </div>

      <!-- Bottom-Left: Recording Controls -->
      <div id="recordingControls"
        class="recording-controls flex flex-col gap-3 md:gap-4 rounded-3xl px-0 py-4 md:px-5 md:py-5">
        <button id="startStopButton"
          class="relative w-full py-3 md:py-4 text-lg md:text-2xl font-heading text-brand bg-black bg-opacity-30 rounded-full shadow-neon transition-all duration-300 ease-in-out focus:outline-none focus-visible:ring-2 focus-visible:ring-brand focus-visible:ring-opacity-75">
          <span class="relative z-10">Start Trip</span>
          <span class="absolute inset-0 rounded-full animate-glowPulse"></span>
        </button>
        <div class="recording-controls__secondary">
          <!-- Mute button, shown only during recording -->
          <button id="muteButton"
            class="hidden flex-1 px-3 py-2 h-11 text-xs md:text-sm font-heading text-white bg-black/60 rounded-full shadow-lg border border-white/20 focus:outline-none focus-visible:ring-2 focus-visible:ring-brand focus-visible:ring-opacity-75 flex items-center justify-center">
            Mute
          </button>
          <!-- Pause/Resume button, shown only during recording -->
          <button id="pauseResumeButton"
            class="hidden flex-1 px-3 py-2 h-11 text-xs md:text-sm font-heading text-black bg-yellow-400/90 rounded-full shadow-lg border border-yellow-200/60 focus:outline-none focus-visible:ring-2 focus-visible:ring-yellow-400 focus-visible:ring-opacity-75 flex items-center justify-center">
            Pause Trip
          </button>
        </div>
      </div>

      <!-- Top-Right: Controls -->
      <button id="exitFullscreenButton" type="button" aria-hidden="true"
        class="focus:outline-none focus-visible:ring-2 focus-visible:ring-brand focus-visible:ring-opacity-75">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6"
          stroke-linecap="round" stroke-linejoin="round">
          <path d="M9 9H5V5" />
          <path d="M15 9h4V5" />
          <path d="M9 15H5v4" />
          <path d="M15 15h4v4" />
          <path d="M9 5l-4 4" />
          <path d="M15 5l4 4" />
          <path d="M9 19l-4-4" />
          <path d="M15 19l4-4" />
        </svg>
      </button>

      <div class="absolute top-4 right-4 md:top-8 md:right-8">
        <div class="relative">
          <button id="settingsButton"
            class="bg-black/60 text-brand p-3 rounded-full shadow-lg border border-brand/40 backdrop-blur focus:outline-none focus-visible:ring-2 focus-visible:ring-brand focus-visible:ring-opacity-75">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 md:h-8 md:w-8" fill="none" viewBox="0 0 24 24"
              stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round"
                d="M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z" />
            </svg>
          </button>
          <div id="settingsMenu"
            class="hidden absolute right-0 top-full mt-2 w-56 bg-surface/95 border border-brand/30 rounded-lg shadow-neon text-sm text-white backdrop-blur z-50 overflow-hidden">
            <button id="driveTypeButton" class="settings-item flex items-center justify-between gap-4">
              <span>Drive Type</span>
              <span id="currentDriveType" class="text-xs uppercase tracking-wide text-white/50"></span>
            </button>
            <button id="captureSettingsButton"
              class="settings-item flex items-center justify-between gap-4 border-t border-white/10">
              <span>Capture Mode</span>
              <span id="currentCaptureSetting" class="text-xs uppercase tracking-wide text-white/50"></span>
            </button>
            <button id="facingCameraButton" class="settings-item flex items-center justify-between gap-4">
              <span>Camera Facing</span>
              <span id="currentFacingSetting" class="text-xs uppercase tracking-wide text-white/50"></span>
            </button>
            <button id="recordingModeButton" class="settings-item flex items-center justify-between gap-4">
              <span>Recording Mode</span>
              <span id="currentRecordingModeSetting" class="text-xs uppercase tracking-wide text-white/50"></span>
            </button>
            <button id="speedUnitButton" class="settings-item flex items-center justify-between gap-4">
              <span>Speed Units</span>
              <span id="currentSpeedUnit" class="text-xs uppercase tracking-wide text-white/50"></span>
            </button>
            <button id="pastTripsButton"
              class="settings-item border-t border-white/5 flex items-center justify-between gap-4">
              <span>View Past Trips</span>
              <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-white/60" fill="none" viewBox="0 0 24 24"
                stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7" />
              </svg>
            </button>
            <button id="cameraDiagToggle"
              class="settings-item border-t border-white/5 flex items-center justify-between gap-4">
              <span>Camera Diagnostics</span>
              <span id="cameraDiagSummary" class="text-xs uppercase tracking-wide text-white/50">Idle</span>
            </button>
          </div>
        </div>
      </div>

    </div>

    <section id="cameraDiag"
      class="hidden absolute top-[7rem] right-4 md:top-[6.5rem] md:right-8 z-50 w-[min(560px,calc(100%-2rem))] max-h-[80vh] overflow-hidden rounded-2xl border border-white/10 bg-[#101010]/95 backdrop-blur-xl shadow-neon p-4 text-white/90 flex flex-col">
      <div class="flex items-start justify-between gap-3 mb-3 flex-shrink-0">
        <div>
          <h3 class="font-heading text-lg">Camera Diagnostics</h3>
          <p id="cameraDiagStatus" class="text-xs text-white/60 mt-1">Run diagnostics to inspect your cameras.</p>
        </div>
        <div class="flex items-center gap-2">
          <button id="cameraDiagRefresh" type="button"
            class="px-3 py-1 rounded-lg border border-brand/50 text-xs font-heading uppercase tracking-wide text-brand hover:bg-brand hover:text-black transition-colors duration-150">
            Refresh
          </button>
          <button id="cameraDiagClose" type="button"
            class="h-7 w-7 rounded-full border border-white/20 text-white/70 hover:text-white hover:border-white/40 flex items-center justify-center">
            ×
          </button>
        </div>
      </div>
      <div class="flex-1 overflow-y-auto">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <div class="text-sm opacity-80 mb-2">Best Front: <strong id="bestFront" class="text-brand">—</strong></div>
            <div id="frontList" class="camera-diag-list">
              <div class="diag-message">Waiting for diagnostics…</div>
            </div>
          </div>
          <div>
            <div class="text-sm opacity-80 mb-2">Best Back: <strong id="bestBack" class="text-brand">—</strong></div>
            <div id="backList" class="camera-diag-list">
              <div class="diag-message">Waiting for diagnostics…</div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Generic Modal for settings (initially hidden) -->
    <div id="settingsModal" class="hidden fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50">
      <div class="bg-surface p-6 rounded-lg shadow-neon text-brand font-body w-11/12 md:w-1/3">
        <h2 id="settingsModalTitle" class="text-xl font-heading mb-4"></h2>
        <div id="settingsModalContent" class="space-y-3">
          <button id="btnSingle"
            class="block w-full text-left p-2 rounded-md hover:bg-brand hover:text-black focus:outline-none focus-visible:ring-2 focus-visible:ring-brand focus-visible:ring-opacity-75">Single
            Camera</button>
          <button id="btnDual"
            class="block w-full text-left p-2 rounded-md hover:bg-brand hover:text-black focus:outline-none focus-visible:ring-2 focus-visible:ring-brand focus-visible:ring-opacity-75">Dual
            Camera</button>
          <div class="border-t border-white/5 my-3"></div>
          <button id="btnFacingUser"
            class="block w-full text-left p-2 rounded-md hover:bg-brand hover:text-black focus:outline-none focus-visible:ring-2 focus-visible:ring-brand focus-visible:ring-opacity-75">Facing:
            User</button>
          <button id="btnFacingEnvironment"
            class="block w-full text-left p-2 rounded-md hover:bg-brand hover:text-black focus:outline-none focus-visible:ring-2 focus-visible:ring-brand focus-visible:ring-opacity-75">Facing:
            Environment</button>
        </div>
        <button id="settingsModalClose"
          class="mt-6 w-full bg-brand text-black py-2 rounded-md font-heading focus:outline-none focus-visible:ring-2 focus-visible:ring-brand focus-visible:ring-opacity-75">Close</button>
      </div>
    </div>

    <!-- Past Trips Overlay (initially hidden) -->
    <div id="pastTripsOverlay" class="hidden fixed inset-0 bg-surface z-40">
      <div class="p-6 text-brand font-body w-full h-full overflow-hidden relative flex flex-col">
        <div class="flex items-center justify-between mb-4">
          <h2 class="text-xl font-heading">Past Trips</h2>
          <div class="flex items-center gap-2">
            <button id="clearTripsButton"
              class="px-3 py-2 text-xs md:text-sm font-heading uppercase tracking-wide bg-red-500/70 text-white rounded-md hover:bg-red-400 focus:outline-none focus-visible:ring-2 focus-visible:ring-brand focus-visible:ring-opacity-75">Clear
              All</button>
            <button id="pastTripsClose"
              class="bg-brand text-black p-2 rounded-full font-heading focus:outline-none focus-visible:ring-2 focus-visible:ring-brand focus-visible:ring-opacity-75">X</button>
          </div>
        </div>
        <p id="emptyTripsMessage" class="hidden text-sm text-white/60 mb-4">No trips recorded yet. Start a trip to see
          it listed here.</p>
        <ul id="tripList" class="space-y-3 overflow-y-auto pr-2"></ul>
      </div>
    </div>

    <!-- Video Player Overlay (for replaying past trips) -->
    <div id="videoPlayerOverlay"
      class="hidden fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center z-50">
      <div class="relative bg-surface p-4 rounded-lg shadow-neon">
        <button id="closeVideoPlayer" class="absolute top-2 right-2 text-brand text-xl font-bold">X</button>
        <video id="replayVideoPlayer" controls class="w-[80vw] h-[80vh] max-w-4xl max-h-2xl"></video>
      </div>
    </div>

    <!-- Trip Summary Overlay (initially hidden) -->
    <div id="tripSummaryOverlay" class="hidden fixed inset-0 bg-[#050505]/95 backdrop-blur-sm z-40">
      <div class="relative flex h-full w-full flex-col text-brand font-body">
        <div class="absolute top-6 right-6 flex items-center gap-3 md:top-10 md:right-12">
          <div class="relative">
            <button id="shareTripSummaryBtn" title="Share summary image" aria-label="Share summary image"
              class="hidden rounded-full bg-white/5 px-4 py-2 text-xs uppercase tracking-[0.3em] text-white/80 transition-opacity duration-200 focus:outline-none focus-visible:ring-2 focus-visible:ring-brand focus-visible:ring-opacity-75 hover:text-white">
              Share
            </button>
            <div id="shareMenu"
              class="hidden absolute right-0 top-full mt-2 w-48 rounded-2xl bg-surface/95 text-sm text-white/90 shadow-neon backdrop-blur z-50">
              <button id="shareVideoOption" class="settings-item">Share Video</button>
              <button id="shareImageOption" class="settings-item">Share Summary Image</button>
            </div>
          </div>
          <button id="tripSummaryClose"
            class="flex h-11 w-11 items-center justify-center rounded-full bg-white/5 text-xl text-white/70 transition-colors duration-200 focus:outline-none focus-visible:ring-2 focus-visible:ring-brand focus-visible:ring-opacity-75 hover:text-white">×</button>
        </div>

        <div class="flex flex-1 items-center justify-center px-6 pb-10 pt-20 md:px-12 md:pt-28">
          <div class="flex w-full max-w-3xl flex-col items-center gap-10 text-center text-white">
            <div class="trip-summary-map relative w-full max-h-[420px] overflow-hidden rounded-[2.5rem]">
              <div id="tripSummaryMap" class="absolute inset-0"></div>
              <div
                class="pointer-events-none absolute inset-0 bg-gradient-to-br from-white/5 via-transparent to-white/0">
              </div>
            </div>

            <div class="flex w-full flex-col items-center gap-4">
              <div class="uppercase tracking-[0.55em] text-xs text-white/30">Trip Summary</div>
              <h2 id="tripSummaryName" class="text-3xl font-heading text-white md:text-4xl">Untitled Drive</h2>
              <p id="tripSummaryStatsLine" class="text-lg font-heading text-white/70 md:text-xl">0 km · 0 min · Avg 0
                km/h</p>
              <p id="tripSummaryNarrative" class="max-w-2xl text-base text-white/70 md:text-lg">You cruised smoothly
                today.</p>
              <div class="mt-4 flex flex-col items-center gap-6 md:flex-row md:gap-16">
                <div class="flex flex-col items-center gap-1">
                  <span class="text-xs uppercase tracking-[0.4em] text-white/30">Elevation</span>
                  <p id="tripSummaryElevation" class="text-lg font-heading text-brand md:text-xl">—</p>
                </div>
                <div class="flex flex-col items-center gap-1">
                  <span class="text-xs uppercase tracking-[0.4em] text-white/30">Start</span>
                  <p id="tripSummaryStartTime" class="text-lg font-heading text-white md:text-xl">—</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

  </div>
  <script type="module" src="/src/js/app.js"></script>
  <div id="shareMenuPortal" class="fixed inset-0 z-[2147483647] pointer-events-none"></div>
</body>

</html>